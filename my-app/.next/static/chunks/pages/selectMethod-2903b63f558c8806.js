(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[810],{9543:function(e,i,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/selectMethod",function(){return t(5567)}])},5567:function(e,i,t){"use strict";t.r(i),t.d(i,{__N_SSP:function(){return j},default:function(){return w}});var s=t(5893),l=t(8932),n=t(7294),d=t(3736);t(2852),t(1116);var a=t(7602),r=t(1163),o=t(7900),c=t.n(o),x=t(7093),h=t.n(x),f=t(3822),g=t(8228),p=t(5152),m=t.n(p),y=t(5829),u=t(1955),v=t(4159);t(8464);var j=!0;function w(e){var i,o,x;t(8284)(e.secretKey);let p=(0,r.useRouter)(),j=m()(()=>t.e(213).then(t.bind(t,4213)),{loadableGenerated:{webpack:()=>[4213]},ssr:!1}),{deliverytype:w,deliverydate:S,cart_ids:b,remark:N,amount:_,payment_amount:C}=p.query,[k,T]=(0,n.useState)(!1),[R,z]=(0,n.useState)(!1),[L,I]=(0,n.useState)(!1),[W,Z]=(0,n.useState)(e.shopList[0]),[D,P]=(0,n.useState)(e.addList.data),[A,E]=(0,n.useState)(!1),[K,O]=(0,n.useState)(null!==(x=Number(e.page))&&void 0!==x?x:1),[$,F]=(0,n.useState)(1),[q,B]=(0,n.useState)(0),[G,H]=(0,n.useState)({}),[X,M]=(0,n.useState)(!1),[J,Q]=(0,n.useState)(""),[U,V]=(0,n.useState)(""),[Y,ee]=(0,n.useState)(""),[ei,et]=(0,n.useState)({}),es=(0,g.D)({mutationKey:["setDefault"],mutationFn:e=>y.Z.setDefaultAddress(e)}),el=(0,g.D)({mutationKey:["CreateOrder"],mutationFn:e=>y.Z.createOrder(e)}),en=(0,g.D)({mutationFn:e=>y.Z.deleteAddress(e),mutationKey:["deleteAddress"]}),ed=e=>{en.mutate({id:e,cookie:u.Z.get("token")},{onSuccess:async e=>{let i=await e.json();401===i.code?(u.Z.remove("token"),location.reload()):1===i.code?location.reload():alert(i.msg)},onError:e=>{alert("删除失败")}})},ea=e=>{D.map(i=>{i.id===e?i.is_default=!0:i.is_default=!1}),P([...D])},er=e=>{V(e),es.mutate({id:e,cookie:u.Z.get("token")},{onSuccess:async i=>{let t=await i.json();401===t.code?(u.Z.remove("token"),location.reload()):1===t.code?ea(e):alert(t.msg)}})};(0,n.useEffect)(()=>{if((null==e?void 0:e.addList)&&u.Z.get("token")){var i;V((null===(i=e.addList)||void 0===i?void 0:i.data.filter(e=>{if(e.is_default)return e}))[0].id)}else alert("登陸失效"),p.replace("/")},[]);let eo=()=>{E(!0),""!==J&&""!==U&&el.mutate({deliverytype:w,deliverydate:S,cart_ids:b,remark:N,amount:_,payment_amount:C,address_id:U,payment_type:J,cookie:u.Z.get("token")},{onSuccess:async e=>{let i=await e.json();401===i.code?(u.Z.remove("token"),location.reload()):1===i.code?(E(!1),"paypal"===J&&ee(i.data.payment_info.approval_url),O(2)):alert(i.msg)},onError:e=>{alert("上傳失敗")}})};return(0,n.useEffect)(()=>{},[el]),(0,s.jsxs)("div",{children:[(0,s.jsx)(l.default,{cateList:e.cateList,setLogin:T}),(0,s.jsxs)("div",{className:c().total_layout,style:{backgroundColor:"rgb(246,248,250)"},children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{style:{display:"flex",justifyContent:"space-around",marginLeft:"5%",marginRight:"5%"},children:[(0,s.jsx)("div",{style:{flex:1}}),(0,s.jsx)("div",{children:"選擇地址"}),(0,s.jsx)("div",{style:{flex:1}}),(0,s.jsx)("div",{children:"選擇支付方式"}),(0,s.jsx)("div",{style:{flex:1}}),(0,s.jsx)("div",{children:"支付結果"}),(0,s.jsx)("div",{style:{flex:1}})]}),(0,s.jsxs)("div",{style:{display:"flex",justifyContent:"space-around",alignItems:"center"},children:[(0,s.jsx)("div",{className:K>=1?c().complete:c().wrong,style:{height:4,flex:1}}),(0,s.jsx)("div",{className:K>=2?c().complete:c().wrong,style:{width:20,height:20,borderRadius:50}}),(0,s.jsx)("div",{className:K>=2?c().complete:c().wrong,style:{height:4,flex:1}}),(0,s.jsx)("div",{className:K>=3?c().complete:c().wrong,style:{width:20,height:20,borderRadius:50}}),(0,s.jsx)("div",{className:K>=3?c().complete:c().wrong,style:{height:4,flex:1}}),(0,s.jsx)("div",{className:K>=3?c().complete:c().wrong,style:{width:20,height:20,borderRadius:50}}),(0,s.jsx)("div",{className:K>=3?c().complete:c().wrong,style:{height:4,flex:1}})]})]}),(0,s.jsxs)("div",{style:{marginTop:24},children:[1===K&&(0,s.jsxs)("div",{className:c().column_control,style:{display:"flex",alignItems:"flex-start"},children:[(0,s.jsxs)("div",{style:{flex:1,marginRight:12,backgroundColor:"white",padding:"3%",borderRadius:8,marginRight:12},children:[(null==w?void 0:w.toString())==="1"?(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:c().title_area,style:{display:"flex",justifyContent:"space-between",alignItems:"flex-end"},children:[(0,s.jsx)("div",{className:c().title,children:"選擇地址"}),(0,s.jsx)("div",{onClick:()=>{M(!0),B(0)},className:h().addAddress_btn,style:{},children:"+ 添加地址"})]}),(0,s.jsx)("div",{style:{display:"flex",flexWrap:"wrap",justifyContent:"space-between",marginTop:24,maxHeight:400,overflow:"auto"},children:D.length?D.map((e,i)=>(0,s.jsx)("div",{className:c().addressItem,style:{padding:14,marginBottom:12},children:(0,s.jsxs)("div",{onClick:()=>er(e.id),className:c().addressItemDetail,style:{paddingLeft:4,flex:1},children:[(0,s.jsxs)("div",{style:{display:"flex",alignItems:"baseline"},children:[(0,s.jsx)("div",{style:{fontSize:18,fontWeight:"bold"},children:null==e?void 0:e.name}),(0,s.jsx)("div",{style:{marginLeft:10},children:"收"})]}),(0,s.jsx)("div",{style:{marginTop:8},children:null==e?void 0:e.mobile}),(0,s.jsx)("div",{style:{marginTop:4},children:null==e?void 0:e.location}),(0,s.jsxs)("div",{onClick:e=>e.stopPropagation(),style:{display:"flex",alignItems:"flex-start",marginTop:12,justifyContent:"flex-end"},children:[e.is_default?(0,s.jsx)("span",{style:{marginRight:12},className:"iconfont",children:""}):(0,s.jsx)("span",{onClick:()=>er(e.id),style:{marginRight:12},className:"iconfont",children:""}),(0,s.jsx)("span",{onClick:i=>{ed(e.id),i.stopPropagation()},style:{marginRight:12,fontSize:14},className:"iconfont",children:"㒲"}),(0,s.jsx)("span",{onClick:i=>{M(!0),setAdd_type(1),H(e),i.stopPropagation()},style:{fontSize:15},className:"iconfont",children:""})]})]})},e.id)):401===e.addList.code?(0,s.jsx)("div",{style:{marginTop:24,width:"100%",textAlign:"center"},children:"登錄失效，請重新登錄"}):(0,s.jsx)("div",{style:{marginTop:24,width:"100%",textAlign:"center"},children:"暫無數據，請先添加"})})]}):(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:c().title_area,style:{display:"flex",justifyContent:"space-between",alignItems:"flex-end"},children:(0,s.jsx)("div",{className:c().title,children:"選擇門店地址"})}),(0,s.jsx)(v.ZP.Group,{children:(0,s.jsx)("div",{style:{marginTop:12,height:200,overflow:"auto"},children:e.shopList.map(e=>(0,s.jsx)(v.ZP,{className:c().shopItem,value:"".concat(e.id),children:(0,s.jsxs)("div",{style:{display:"flex",flexDirection:"column",marginLeft:12,fontSize:12},children:[(0,s.jsx)("div",{style:{fontSize:14,fontWeight:700},children:null==e?void 0:e.storename}),(0,s.jsxs)("div",{children:["地址:",null==e?void 0:e.address]}),(0,s.jsxs)("div",{children:["聯係人:",null==e?void 0:e.name," ","電話:"+(null==e?void 0:e.mobile)]})]})},e.id))})})]}),(0,s.jsx)("div",{className:c().title_area,style:{display:"flex",justifyContent:"space-between",alignItems:"flex-end",marginTop:24},children:(0,s.jsx)("div",{className:c().title,children:"支付方式"})}),(0,s.jsx)("div",{style:{marginTop:24},children:(0,s.jsx)(v.ZP.Group,{onChange:Q,children:(0,s.jsx)("div",{className:c().selectPayment,style:{padding:8,marginTop:8},children:(0,s.jsxs)(v.ZP,{value:"paypal",children:[(0,s.jsx)("img",{src:"/paypal.png",style:{height:80,marginRight:16,marginLeft:16,borderRadius:4}})," ",(0,s.jsx)("span",{style:{fontWeight:700,fontSize:16},children:"使用paypal 支付"})]})})})})]}),(0,s.jsxs)("div",{className:c().rightContain,style:{backgroundColor:"white",padding:"3%",borderRadius:8},children:[(0,s.jsx)("div",{className:c().title_area,children:(0,s.jsx)("div",{className:c().title,children:"訂單商品"})}),(0,s.jsx)("div",{className:c().title_area,children:e.goodsList&&e.goodsList.map((e,i)=>(0,s.jsxs)("div",{style:{display:"flex",alignItems:"center",marginTop:24},children:[(0,s.jsx)("img",{src:e.coverimage,style:{width:"30%",marginRight:12}}),(0,s.jsxs)("div",{style:{flex:1},children:[(0,s.jsx)("div",{style:{fontSize:18,height:40,width:"100%",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.productname}),(0,s.jsx)("div",{style:{fontSize:12,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.cardtype?"需要心意卡":"無需心意卡"})]}),(0,s.jsxs)("div",{style:{textAlign:"right"},children:[(0,s.jsxs)("div",{style:{fontSize:12},children:["$",e.price]}),(0,s.jsxs)("div",{children:["\xd7",e.num]})]})]},e.id))}),(0,s.jsxs)("div",{className:c().title_area,children:[(0,s.jsxs)("div",{style:{marginTop:8,display:"flex",flexDirection:"row",justifyContent:"space-between"},children:[(0,s.jsx)("div",{children:"商品總價"}),(0,s.jsxs)("div",{children:["$",_]})]}),(0,s.jsxs)("div",{style:{marginTop:8,display:"flex",flexDirection:"row",justifyContent:"space-between"},children:[(0,s.jsx)("div",{children:"應付價格:"}),(0,s.jsxs)("div",{children:["$",C]})]}),(0,s.jsxs)("div",{style:{marginTop:8,display:"flex",flexDirection:"row",justifyContent:"space-between"},children:[(0,s.jsx)("div",{style:{fontWeight:700,fontSize:18},children:"總價:"}),(0,s.jsxs)("div",{style:{color:"#dc3545",fontWeight:700,fontSize:18},children:["HK$",C]})]})]}),(0,s.jsx)("div",{style:{display:"flex",marginTop:12,alignItems:"center",justifyContent:"center"},children:A?(0,s.jsx)("div",{className:c().new_Step,style:{backgroundColor:"rgba(0,0,0,0.4)"},children:"確認訂單"}):(0,s.jsx)("div",{onClick:()=>eo(),className:c().new_Step,children:"確認訂單"})})]})]}),2===K&&("stripe"===J?(0,s.jsx)(j,{}):(0,s.jsxs)("div",{style:{display:"flex",flexDirection:"column",justifyContent:"center",textAlign:"center",padding:"5%",borderRadius:8,backgroundColor:"white"},children:[(0,s.jsx)("div",{style:{fontSize:24,fontWeight:700},children:"訂單創建成功，請支付"}),(0,s.jsxs)("div",{style:{textAlign:"center",marginTop:12,marginBottom:12,display:"flex",flexWrap:"wrap",justifyContent:"space-between",padding:16,backgroundColor:"rgb(255,250,240)"},children:[(0,s.jsxs)("div",{style:{display:"flex",flex:1,alignItems:"baseline"},children:[(0,s.jsx)("div",{children:"支付方式:"}),(0,s.jsx)("div",{style:{fontSize:17,fontWeight:600},children:"paypal"})]}),(0,s.jsxs)("div",{style:{display:"flex",flex:1,alignItems:"baseline"},children:[(0,s.jsx)("div",{children:"總價:"}),(0,s.jsx)("div",{style:{fontSize:17,fontWeight:600},children:"HK$123"})]}),(0,s.jsxs)("div",{style:{display:"flex",flex:1,alignItems:"baseline"},children:[(0,s.jsx)("div",{children:"狀態:"}),(0,s.jsx)("div",{style:{fontSize:17,fontWeight:600},children:"等待支付"})]})]}),(0,s.jsxs)("div",{style:{paddingLeft:24,paddingRight:24,paddingTop:6,paddingBottom:6,cursor:"pointer",marginTop:12,borderRadius:4},onClick:()=>p.replace("".concat(Y)),children:[(0,s.jsx)("span",{className:"iconfont",children:""}),"點此前往支付"]})]})),3===K&&(0,s.jsxs)("div",{style:{width:"100%",height:200,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"},children:[(null===(i=p.query)||void 0===i?void 0:i.type)==="success"?(0,s.jsx)("div",{style:{marginTop:24,fontSize:28,fontWeight:600},children:"付款成功"}):(null===(o=p.query)||void 0===o?void 0:o.type)==="fail"?(0,s.jsx)("div",{style:{marginTop:24,fontSize:28,fontWeight:600},children:"付款失敗"}):(0,s.jsx)("div",{style:{marginTop:24,fontSize:28,fontWeight:600},children:"用戶取消支付"}),(0,s.jsx)("div",{style:{marginTop:24,cursor:"pointer"},onClick:()=>p.replace("/"),children:"返回首頁"})]})]})]}),(0,s.jsx)(a.default,{}),(0,s.jsx)(d.default,{login:k,close:()=>T(!1),toRegister:()=>{T(!1),z(!0)},toForget:()=>{T(!1),I(!0)}}),(0,s.jsx)(f.default,{type:q,item:G,visible:X,close:()=>M(!1)})]})}},4654:function(){}},function(e){e.O(0,[700,848,962,345,946,116,736,569,774,888,179],function(){return e(e.s=9543)}),_N_E=e.O()}]);